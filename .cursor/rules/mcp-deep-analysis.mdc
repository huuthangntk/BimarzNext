---
description: Critical thinking workflow - Sequential Thinking and Perplexity Search protocol
alwaysApply: true
---

# Thinking & Research Protocol

**MANDATORY: Execute this workflow at the start of every conversation and when significant new information arrives.**

## Phase 1: Initial Analysis (3 Sequential Thinking Sessions)

### Session #1 - Understand Request
- What is the core requirement?
- What are explicit vs implicit needs?
- What context exists in the codebase?
- What constraints apply (technical, design, performance)?

### Session #2 - Identify Knowledge Gaps
   - What information is missing?
- Have technologies updated since my knowledge cutoff?
- What best practices need verification?
- What edge cases or integration points exist?
- What ambiguities need clarification?

### Session #3 - Plan Information Gathering
- What specific searches will fill gaps?
- What search queries and recency filters to use?
- What existing files should I read?
- How will I synthesize findings?

## Phase 2: Research (Perplexity Searches)

**Number of searches:** 1-5+ based on complexity

**Search query quality:**
- ✅ Good: "Next.js 14 App Router animation performance optimization 2025"
- ❌ Bad: "Next.js animations"

**Use `search_recency_filter: "month"` for tech topics**

**CRITICAL: After EACH search, run Sequential Thinking to:**
- Analyze what was learned
- Integrate with existing knowledge
- Determine if more searches needed
- Refine approach based on findings

## Phase 3: Deep Context Synthesis (claude_think)

**MANDATORY: After all Perplexity searches and their Sequential Thinking sessions complete, use claude_think tool to:**

### Purpose of claude_think at this stage:
- Synthesize all gathered information into coherent understanding
- Process search results holistically, not just individually
- Identify patterns and connections across findings
- Map solution architecture comprehensively
- Consider all edge cases discovered
- Analyze trade-offs between approaches
- Anticipate potential issues and pitfalls
- Create mental model of complete solution

### What to include in claude_think:
```typescript
mcp_Claude_Deep_Think_Docker_claude_think({
  query: "Synthesize findings from Perplexity searches about [topic] and determine optimal implementation approach",
  context: `
    - User request: [original request]
    - Search findings: [key points from all searches]
    - Project constraints: [tech stack, patterns, limitations]
    - Conflicting information: [if any]
    - Open questions: [remaining uncertainties]
  `
})
```

### This deep thinking should produce:
- Clear understanding of all discovered information
- Identified best approach with rationale
- Recognized edge cases and how to handle them
- Anticipated problems and prevention strategies
- Complete mental model of the solution

## Phase 4: Post-Synthesis Validation (3 Sequential Thinking Sessions)

**After claude_think completes, run 3 more Sequential Thinking sessions to validate and plan:**

### Session #N - Validate Synthesis
- Does the claude_think analysis make sense?
- Are all search findings incorporated?
- Have we missed anything critical?
- Is the chosen approach sound?
- Any contradictions to resolve?

### Session #N+1 - Design Complete Solution
- Step-by-step implementation plan
- Which files to modify/create
- Order of operations
- Potential side effects
- Alignment with project patterns
- Integration with claude_think insights

### Session #N+2 - Final Confidence Check
- How will we verify solution works?
- What testing is needed?
- What could go wrong?
- Prevention strategies in place?
- Ready to implement with confidence?

## Phase 5: Ongoing Thinking

Continue Sequential Thinking when:
- New complexity emerges
- Unexpected behavior occurs
- Multiple approaches exist
- Verification reveals issues

## Workflow Summary

```
START → 3x Sequential Thinking (Understand/Gaps/Plan)
     → Perplexity Searches (with Sequential Thinking after each)
     → claude_think (Deep Context Synthesis)
     → 3x Sequential Thinking (Validate/Design/Confidence Check)
     → Implementation (with ongoing thinking as needed)
```

### Detailed Flow:

1. **Phase 1**: 3 Sequential Thinking sessions to analyze request and plan
2. **Phase 2**: Execute Perplexity searches, process each with Sequential Thinking
3. **Phase 3**: Use claude_think to synthesize all findings comprehensively
4. **Phase 4**: 3 Sequential Thinking sessions to validate and finalize plan
5. **Phase 5**: Implement with ongoing Sequential Thinking as needed

## Exceptions

Skip this protocol ONLY for:
- Trivial typo fixes
- Exact code reproductions
- Simple color value changes
- User explicitly requests "quick, don't overthink"

**Even then, do 5-second sanity check before acting.**

## Quality Indicators

✅ Protocol working well when:
- Every chat starts with 3 Sequential Thinking sessions
- Searches provide actionable information
- Each search result processed with Sequential Thinking
- **claude_think synthesizes all findings comprehensively**
- Final 3 Sequential Thinking sessions validate approach
- Solutions incorporate latest practices
- Edge cases considered proactively
- Complete mental model established before coding

❌ Red flags:
- Skipping initial thinking sessions
- Running searches without processing results
- **Skipping claude_think synthesis step**
- Not validating claude_think insights
- Vague search queries
- Ignoring search findings
- Rushing to implementation without full workflow